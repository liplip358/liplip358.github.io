<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-t">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>{{ page.title }} | {{ site.name }}</title>

    {% seo %}

    <link rel="shortcut icon" type="image/x-icon" href="{{ '/' | relative_url }}{{ site.favicon }}">

    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700" rel="stylesheet">

    <!-- Bootstrap Modified -->
    <link rel="stylesheet" href="{{ '/assets/css/blog_page/main.css' | relative_url }}">

    <!-- Theme Stylesheet -->
    <link rel="stylesheet" href="{{ '/assets/css/blog_page/theme.css' | relative_url }}">

    <!-- jQuery -->
    <script
    src="https://code.jquery.com/jquery-3.3.1.min.js"
    integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
    crossorigin="anonymous"></script>

    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>

    {% include tracking-header.html %}
</head>

<!-- 💡 關鍵 1: 移除 body 標籤上寫死的 "dark-mode" class -->
<body class="{% if page.url == "/" %} homefirstpage {% endif %}">

<!-- 💡 START: 把你原始 JS 檔的「第一部分」放在這裡 -->
<script>
(function () {
  const body = document.body;
  try {
    // 1️⃣ 頁面一開始先套用使用者上次選擇的模式，避免閃白
    const savedTheme = localStorage.getItem("theme");
    if (!savedTheme || savedTheme === "dark") {
      body.classList.add("dark-mode");
      // 如果是第一次訪問，幫使用者設定好預設值
      if (!savedTheme) localStorage.setItem("theme", "dark");
    } 
    // 注意：這裡不需要 else { body.classList.remove("dark-mode"); }
    // 因為 body 預設就是乾淨的（亮色），所以亮色模式什麼都不用做。
  } catch(e) {
    // 如果 localStorage 無法存取，預設為暗色
    console.error("Failed to apply theme from localStorage.", e);
    body.classList.add("dark-mode");
  }
})();
</script>
<!-- 💡 END: 初始化邏輯結束 -->

    <!-- Navbar (你的網頁內容從這裡開始) -->
    <nav id="MagicMenu" class="topnav navbar navbar-expand-lg navbar-light bg-white fixed-top">
        <div class="container">
        <a class="navbar-brand" href="{{ '/' | relative_url }}"><strong>{{site.name}}</strong></a>
        <button class="navbar-toggler collapsed" type="button" data-toggle="collapse" data-target="#navbarColor02" aria-controls="navbarColor02" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
        </button>
        <div class="navbar-collapse collapse" id="navbarColor02" style="">
            <ul class="navbar-nav mr-auto d-flex align-items-center">
               {% include menu-header.html %}
            </ul>
            <ul class="navbar-nav ml-auto d-flex align-items-center">
                {% include search-lunr.html %}
            </ul>
        </div>
        </div>
    </nav>
    
    <!-- Search Results -->
    <div id="lunrsearchresults">
        <ul class="mb-0"></ul>
    </div>

    <!-- Content -->
    <main role="main" class="site-content">
        {{ content }}
    </main>


    <!-- Scripts: popper, bootstrap, theme, lunr -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut" crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k" crossorigin="anonymous"></script>

    <script src="{{ '/' | relative_url }}assets/js/blog_page/theme.js"></script>

    <!-- Footer -->
    <footer class="bg-white border-top p-3 text-muted small">
        <div class="container">
        <div class="row align-items-center justify-content-between">
            <div>
                <span class="navbar-brand mr-2 mb-0"><strong>Deveraph</strong></span>
                <span>Copyright &copy; <script>document.write(new Date().getFullYear())</script></span>
                <a class="ml-1" target="_blank" href="https://www.instagram.com/velseraph/">
                <ion-icon class="ionicon" name="logo-instagram"></ion-icon>
                </a>
            </div>
            <div>
                <a href="mailto:contact@deveraph.com">contact@deveraph.com</a>
            </div>
            <div>
                Acknowledgement  <a target="_blank" class="text-dark font-weight-bold" href="https://www.wowthemes.net/"></a> <a  target="_blank" href="https://www.wowthemes.net">WowThemes</a>
            </div>
        </div>
        </div>
    </footer>
    {% include tracking-footer.html %}

    <button class="bright-and-dark-mode-btn dark-mode btn" id="dark-mode"><ion-icon name="contrast-outline"></ion-icon></button>
    
    <!-- 💡 關鍵 3: 這個 JS 檔案現在只負責 "點擊事件"，初始化已由上面的腳本完成 -->
    <script src="{{ '/assets/js/blog_page/dark-mode.js' | relative_url }}"></script>

</body>
</html>